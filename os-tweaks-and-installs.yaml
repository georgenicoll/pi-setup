- hosts: localhost
  become: yes
  gather_facts: no

  tasks:

  - name: Make OS Tweaks
    ansible.builtin.include_tasks:
      file: os/tweaks.yaml

  - name: Make Audio Tweaks
    ansible.builtin.include_tasks:
      file: os/audio.yaml

  - name: Adding dpkg armhf architecture
    ansible.builtin.shell:
      cmd: dpkg --add-architecture armhf

  - name: Dist upgrade
    ansible.builtin.apt:
      update_cache: yes
      upgrade: dist

  - name: Uninstall packages
    ansible.builtin.apt:
      state: absent
      pkg:
      - indicator-multiload
      - chromium-browser
      - firefox

  - name: Auto remove un-needed packages
    ansible.builtin.apt:
      autoremove: yes

  - name: Auto clean
    ansible.builtin.apt:
      autoclean: yes

  - name: Install Standard Packages
    ansible.builtin.apt:
      state: present
      pkg:
      - vim
      - fzf
      - build-essential
      - cmake
      - pi-bluetooth
      - raspi-config
      - meld
      - htop

  - name: Install Chrome (can't do this as it's only amd64, NOT arm64)
    ansible.builtin.include_tasks: 
      file: softwares/chromium.yaml
    when: no

  - name: Install VSCode
    ansible.builtin.include_tasks:
      file: softwares/vscode.yaml
    when: no
  
  - name: Install i3
    ansible.builtin.include_tasks:
      file: softwares/i3.yaml
    when: no

  - name: Install nix
    ansible.builtin.include_tasks:
      file: softwares/nix.yaml
    when: no
      
  - name: Install nix packages
    ansible.builtin.include_tasks:
      file: softwares/nix-packages.yaml
    when: no

  - name: Add Chromium sync workaround
    ansible.builtin.include_tasks:
      file: softwares/chromium-sync-workaround.yaml
    when: no #Not working, chromium doesn't sync with this

  - name: Add Citrix
    ansible.builtin.include_tasks:
      file: softwares/citrix.yaml
    when: yes

  - name: Build & Install box(86|64)
    ansible.builtin.include_tasks:
      file: softwares/box.yaml
    when: no

  - name: Zoom
    ansible.builtin.include_tasks:
      file: softwares/zoom.yaml
    when: yes

  - name: Dropbox
    ansible.builtin.include_tasks:
      file: softwares/dropbox.yaml
    when: yes

